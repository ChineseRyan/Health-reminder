<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå®šä¹‰æé†’åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d2e;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffeaea;
            color: #d32f2f;
            border: 1px solid #f44336;
        }
        .info {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #2196f3;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005bb5;
        }
        .feature-demo {
            display: flex;
            gap: 20px;
            align-items: center;
            margin: 10px 0;
        }
        .counter-display {
            background: #007aff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ è‡ªå®šä¹‰æé†’åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ åŠŸèƒ½è¯´æ˜</h2>
        <p>è‡ªå®šä¹‰æé†’åŠŸèƒ½å…è®¸ç”¨æˆ·è®¾ç½®ï¼š</p>
        <ul>
            <li><strong>Nå€¼ï¼š</strong>æ¯Næ¬¡äº‹ä»¶åè§¦å‘æé†’</li>
            <li><strong>XXäº‹ä»¶ï¼š</strong>é€‰æ‹©"ä¹…å"ã€"å–æ°´"æˆ–"æŠ¤çœ¼"æé†’</li>
            <li><strong>YYæç¤ºè¯­ï¼š</strong>è‡ªå®šä¹‰æé†’å†…å®¹</li>
        </ul>
        <p>å½“è¾¾åˆ°è®¾å®šçš„æ¬¡æ•°æ—¶ï¼Œä¼šæ˜¾ç¤ºç‰¹æ®Šçš„è‡ªå®šä¹‰æé†’å¼¹çª—ã€‚</p>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        
        <div class="feature-demo">
            <button onclick="simulateEvent('sit')">æ¨¡æ‹Ÿä¹…åæé†’</button>
            <button onclick="simulateEvent('water')">æ¨¡æ‹Ÿå–æ°´æé†’</button>
            <button onclick="simulateEvent('eye')">æ¨¡æ‹ŸæŠ¤çœ¼æé†’</button>
            <span id="counter-display" class="counter-display">è®¡æ•°: 0</span>
        </div>
        
        <div class="feature-demo">
            <button onclick="resetCounters()">é‡ç½®è®¡æ•°å™¨</button>
            <button onclick="addTestReminder()">æ·»åŠ æµ‹è¯•æé†’</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•æ•°æ®</h2>
        <div id="test-data">
            <p>æœ¬åœ°å­˜å‚¨ä¸­çš„è‡ªå®šä¹‰æé†’é…ç½®ï¼š</p>
            <pre id="reminders-data">åŠ è½½ä¸­...</pre>
            <p>äº‹ä»¶è®¡æ•°å™¨ï¼š</p>
            <pre id="counters-data">åŠ è½½ä¸­...</pre>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿäº‹ä»¶è®¡æ•°å™¨
        let eventCounters = { sit: 0, water: 0, eye: 0 };
        let customReminders = [];
        
        // äº‹ä»¶åç§°æ˜ å°„
        const eventNames = {
            sit: 'ä¹…åæé†’',
            water: 'å–æ°´æé†’',
            eye: 'æŠ¤çœ¼æé†’'
        };
        
        // åˆå§‹åŒ–
        function init() {
            loadData();
            updateDisplay();
            showResult('æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–', 'info');
        }
        
        // ä»localStorageåŠ è½½æ•°æ®
        function loadData() {
            try {
                const settings = JSON.parse(localStorage.getItem('healthReminder_settings') || '{}');
                customReminders = settings.customReminders || [];
                
                const counters = JSON.parse(localStorage.getItem('healthReminder_eventCounters') || '{}');
                eventCounters = counters || { sit: 0, water: 0, eye: 0 };
                
                updateDataDisplay();
            } catch (error) {
                showResult('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ›´æ–°æ•°æ®æ˜¾ç¤º
        function updateDataDisplay() {
            document.getElementById('reminders-data').textContent = JSON.stringify(customReminders, null, 2);
            document.getElementById('counters-data').textContent = JSON.stringify(eventCounters, null, 2);
        }
        
        // æ¨¡æ‹Ÿäº‹ä»¶è§¦å‘
        function simulateEvent(eventType) {
            eventCounters[eventType]++;
            saveCounters();
            
            const count = eventCounters[eventType];
            showResult(`è§¦å‘äº† ${eventNames[eventType]} - ç¬¬ ${count} æ¬¡`, 'info');
            
            // æ£€æŸ¥è‡ªå®šä¹‰æé†’
            checkCustomReminders(eventType, count);
            
            updateDisplay();
        }
        
        // æ£€æŸ¥è‡ªå®šä¹‰æé†’
        function checkCustomReminders(eventType, count) {
            customReminders.forEach(reminder => {
                if (reminder.enabled && reminder.eventType === eventType && count % reminder.frequency === 0) {
                    showCustomReminder(reminder, count);
                }
            });
        }
        
        // æ˜¾ç¤ºè‡ªå®šä¹‰æé†’
        function showCustomReminder(reminder, count) {
            const message = reminder.message.replace('{count}', count);
            const title = `å·²è¾¾åˆ° ${count} æ¬¡${eventNames[reminder.eventType]}`;
            
            showResult(`ğŸ¯ è‡ªå®šä¹‰æé†’è§¦å‘ï¼<br><strong>${title}</strong><br>${message}`, 'success');
            
            // æ¨¡æ‹Ÿå¼¹çª—æ•ˆæœ
            alert(`ğŸ¯ è‡ªå®šä¹‰æé†’\n${title}\n${message}`);
        }
        
        // æ·»åŠ æµ‹è¯•æé†’
        function addTestReminder() {
            const testReminder = {
                eventType: 'sit',
                frequency: 3,
                message: 'å¤ªæ£’äº†ï¼ä½ å·²ç»å®Œæˆäº†{count}æ¬¡ä¹…åæé†’ï¼Œè®°å¾—ç«™èµ·æ¥æ´»åŠ¨ä¸€ä¸‹ï¼',
                enabled: true
            };
            
            customReminders.push(testReminder);
            saveReminders();
            
            showResult('å·²æ·»åŠ æµ‹è¯•æé†’ï¼šæ¯3æ¬¡ä¹…åæé†’åè§¦å‘', 'success');
            updateDataDisplay();
        }
        
        // é‡ç½®è®¡æ•°å™¨
        function resetCounters() {
            eventCounters = { sit: 0, water: 0, eye: 0 };
            saveCounters();
            updateDisplay();
            showResult('è®¡æ•°å™¨å·²é‡ç½®', 'info');
        }
        
        // ä¿å­˜æ•°æ®
        function saveReminders() {
            try {
                const settings = JSON.parse(localStorage.getItem('healthReminder_settings') || '{}');
                settings.customReminders = customReminders;
                localStorage.setItem('healthReminder_settings', JSON.stringify(settings));
            } catch (error) {
                showResult('ä¿å­˜æé†’å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function saveCounters() {
            try {
                localStorage.setItem('healthReminder_eventCounters', JSON.stringify(eventCounters));
            } catch (error) {
                showResult('ä¿å­˜è®¡æ•°å™¨å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const totalCount = eventCounters.sit + eventCounters.water + eventCounters.eye;
            document.getElementById('counter-display').textContent = `æ€»è®¡: ${totalCount}`;
            updateDataDisplay();
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
            
            // é™åˆ¶æ˜¾ç¤ºæ•°é‡
            while (resultsDiv.children.length > 10) {
                resultsDiv.removeChild(resultsDiv.lastChild);
            }
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>